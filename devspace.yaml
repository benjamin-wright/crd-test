version: v1beta6
images:
  pipeline-monitor:
    image: localhost:31500/pipeline-monitor
    dockerfile: ./operators/pipeline-monitor/Dockerfile
    context: ./operators/pipeline-monitor
  task-monitor:
    image: localhost:31500/task-monitor
    dockerfile: ./operators/task-monitor/Dockerfile
    context: ./operators/task-monitor
  version-monitor:
    image: localhost:31500/version-monitor
    dockerfile: ./operators/version-monitor/Dockerfile
    context: ./operators/version-monitor

deployments:
- name: crds
  helm:
    chart:
      name: deployment/crds
- name: operators
  helm:
    chart:
      name: deployment/operators
    values:
      pipeline-monitor:
        image: localhost:31500/pipeline-monitor
      task-monitor:
        image: localhost:31500/task-monitor
      version-monitor:
        image: localhost:31500/version-monitor

hooks:
  - command: helm
    args:
      - dependency
      - update
      - ./deployment/operators
    when:
      before:
        deployments: all

commands:
- name: deploy
  command: devspace deploy
- name: init
  command: ./scripts/start.sh
- name: clean
  command: ./scripts/stop.sh
- name: add-resources
  command: kubectl apply -f tests
- name: remove-resources
  command: kubectl delete -f tests